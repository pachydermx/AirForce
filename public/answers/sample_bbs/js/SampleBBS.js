function SampleBBS(t,e){this.url=t,this.board=e,this.board.empty();var i=$("<table>"),d=$('<thead><tr><th class="date">日付</th><th class="name">名前</th><th class="message">メッセージ</th><th class="delete"></th></tr></thead>');this.tbody=$("<tbody>"),i.append(d).append(this.tbody),this.board.append(i);var a=this,s=$("<input>");this.input=s,this.msgToEdit=null,s.addClass("edit_message"),s.css("position","absolute"),s.on("focusout",function(){s.is(":visible")&&a.finishEditing(!1)}),s.on("keypress",function(t){27==t.keyCode?a.finishEditing(!1):13==t.keyCode&&a.finishEditing(s.val()!=a.msgToEdit.text())}),s.hide(),this.board.append(s),$(document).on("click",".message .body",function(){a.msgToEdit=$(this);var t=a.msgToEdit.css(["margin-top","margin-right","margin-bottom","margin-left","border-top-width","border-right-width","border-bottom-width","border-left-width","padding-top","padding-right","padding-bottom","padding-left","text-align","font-size","font-family","font-weight"]);s.css(t),s.val(a.msgToEdit.text()),s.width(a.msgToEdit.width()),s.height(a.msgToEdit.height()),s.show(),s.offset(a.msgToEdit.offset()),s.focus(),s.select()}),$(document).on("click",".message .delete_button",function(){var t=$(this).siblings(".id").text();$(this).parent().addClass("delete_selected"),confirm("メッセージを削除していいですか？")&&$.ajax({url:a.url+"/"+t,type:"DELETE"}).done(function(){a.updateBBS()}),$(this).parent().removeClass("delete_selected")}),$(window).on("resize",function(){a.input.is(":visible")&&(s.width(a.msgToEdit.width()),s.height(a.msgToEdit.height()),s.offset(a.msgToEdit.offset()))})}SampleBBS.prototype.finishEditing=function(t){var e=this;if(t){var i=e.msgToEdit.siblings(".id").text(),d=e.msgToEdit.siblings(".name").text(),a=e.msgToEdit.siblings(".date").attr("data-date"),s=e.input.val();$.ajax({url:e.url+"/"+i,type:"PUT",contentType:"application/json",data:JSON.stringify({_id:i,name:d,date:Number(a),body:s})}).done(function(){e.updateBBS(function(){e.input.hide()})})}else e.input.hide()},SampleBBS.prototype.updateBBS=function(t){var e=this.tbody;$.ajax({url:this.url,type:"GET",dataType:"json"}).done(function(i){e.empty();for(var d=0;d<i.length;d++){var a=i[d],s=$("<tr></tr>").addClass("message"),n=$("<td></td>").addClass("date").text(new Date(Number(a.date)).toLocaleString());n.attr("data-date",a.date),s.append(n),s.append($("<td></td>").addClass("name").text(a.name)),s.append($("<td></td>").addClass("body").text(a.body));var o=$("<td></td>").addClass("delete_button").append('<i class="fa fa-trash-o"></i>');s.append(o),s.append($("<td></td>").addClass("id").text(a._id).hide()),e.append(s)}t&&t()})},SampleBBS.prototype.send=function(){var t=this;$.ajax({url:this.url,type:"POST",contentType:"application/json",data:JSON.stringify({name:$("#name").val(),date:(new Date).getTime(),body:$("#message").val()})}).done(function(){t.updateBBS()})};
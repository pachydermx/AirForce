var SimpleDraw=function(t){this.canvas=t,this.foreground=document.createElement("canvas"),this.foreground.width=this.canvas.width,this.foreground.height=this.canvas.height,this.foreground.style.position="absolute",this.foreground.style.borderStyle=this.canvas.style.borderStyle,this.foreground.style.borderWidth=this.canvas.style.borderWidth,this.foreground.style.padding=this.canvas.style.padding,this.foreground.style.margin=this.canvas.style.margin,this.foreground.style.zIndex="999",this.foregroundRects=[],this.canvas.parentNode.appendChild(this.foreground),this.foreground.addEventListener("mousedown",this.mousedown.bind(this),!1),this.mousemove=this.mousemove.bind(this),this.mouseup=this.mouseup.bind(this),this.setMode("brush")};SimpleDraw.prototype.lastPos={x:0,y:0},SimpleDraw.prototype.fillStyle="rgba(0, 0, 0, 0.1)",SimpleDraw.prototype.strokeStyle="rgba(0, 0, 0, 0.3)",SimpleDraw.prototype.brushSize=10,SimpleDraw.prototype.penSize=5,SimpleDraw.prototype.clear=function(){var t=this.canvas.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height)},SimpleDraw.prototype.setMode=function(t){this.mode=t},SimpleDraw.prototype.transCoord=function(t){var e=this.canvas.getBoundingClientRect(),o=Math.round(e.left)+this.canvas.clientLeft,s=Math.round(e.top)+this.canvas.clientTop,i=t.clientX-o,r=t.clientY-s;return{x:i,y:r}},SimpleDraw.prototype.mousedown=function(t){SimpleDraw[this.mode].mousedown.call(this,t),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),t.preventDefault()},SimpleDraw.prototype.mousemove=function(t){SimpleDraw[this.mode].mousemove.call(this,t)},SimpleDraw.prototype.mouseup=function(t){SimpleDraw[this.mode].mouseup.call(this,t),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1)},SimpleDraw.prototype.drawBrush=function(t,e){var o=this.canvas.getContext("2d");o.fillStyle=this.fillStyle;var s=0,i=2*Math.PI;o.beginPath(),o.arc(t,e,this.brushSize,s,i,!0),o.fill()},SimpleDraw.prototype.drawPen=function(t,e,o,s){var i=this.canvas.getContext("2d");i.lineCap="butt",i.lineJoin="bevel",i.lineWidth=this.penSize,i.beginPath(),i.moveTo(t,e),i.lineTo(o,s),i.strokeStyle=this.strokeStyle,i.stroke()},SimpleDraw.prototype.drawRect=function(t,e,o,s){var i=this.canvas.getContext("2d");i.fillStyle=this.fillStyle,i.fillRect(t,e,o,s)},SimpleDraw.prototype.updateForeground=function(){var t=this.foreground.getContext("2d");t.clearRect(0,0,this.foreground.width,this.foreground.height),t.fillStyle=this.fillStyle,this.foregroundRects.forEach(function(e){t.fillRect(e.left,e.top,e.width,e.height)})},SimpleDraw.brush={},SimpleDraw.brush.mousedown=function(){},SimpleDraw.brush.mousemove=function(t){var e=this.transCoord(t);this.drawBrush(e.x,e.y)},SimpleDraw.brush.mouseup=function(){},SimpleDraw.pen={},SimpleDraw.pen.mousedown=function(t){this.lastPos=this.transCoord(t)},SimpleDraw.pen.mousemove=function(t){var e=this.transCoord(t);this.drawPen(this.lastPos.x,this.lastPos.y,e.x,e.y),this.lastPos=e},SimpleDraw.pen.mouseup=function(){},SimpleDraw.rect={},SimpleDraw.rect.mousedown=function(t){var e=this.transCoord(t);this.lastPos=e,this.currentRect={left:e.x,top:e.y,width:0,height:0},this.foregroundRects.push(this.currentRect)},SimpleDraw.rect.mousemove=function(t){var e=this.transCoord(t),o=e.x-this.lastPos.x,s=e.y-this.lastPos.y;this.currentRect.width=o,this.currentRect.height=s,this.updateForeground()},SimpleDraw.rect.mouseup=function(t){var e=this.transCoord(t),o=e.x-this.lastPos.x,s=e.y-this.lastPos.y;this.drawRect(this.lastPos.x,this.lastPos.y,o,s);var i=this.foregroundRects.indexOf(this.currentRect);this.foregroundRects.splice(i),this.currentRect=null,this.updateForeground()};